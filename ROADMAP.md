# COMPASS 개발 로드맵

> **최종 업데이트**: 2026-02-19 (1-6 Step 2 Server Actions 완료)

## 개발 전략

```
┌─────────────────────────────────────────────────────────────────┐
│                    Phase 0: 최소 공통 기능                        │
│  (프로젝트 설정, Supabase 연동, 기본 레이아웃, AI 추상화)           │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│  단계 1: 1-1 → 1-2 → ... → 1-8 → 통합 테스트 → 완료              │
├─────────────────────────────────────────────────────────────────┤
│  단계 2: 2-1 → 2-2 → ... → 2-9 → 통합 테스트 → 완료              │
├─────────────────────────────────────────────────────────────────┤
│  단계 3: 3-1 → 3-2 → ... → 3-5 → 통합 테스트 → 완료              │
├─────────────────────────────────────────────────────────────────┤
│  단계 4: 4-1 → 4-2 → ... → 4-5 → 통합 테스트 → 완료              │
└─────────────────────────────────────────────────────────────────┘
```

**핵심 원칙**: 각 스텝을 순차적으로 완료한 후 다음 스텝 진행

---

## Phase 0: 최소 공통 기능

> **목표**: 이후 단계의 개발 기반 구축

### 0-1. 프로젝트 초기화 ✅

- ✅ Next.js 15 + TypeScript 설정 (실제: Next.js 16.1.6 + React 19)
- ✅ TailwindCSS v4 설정
- ✅ shadcn/ui 컴포넌트 라이브러리 설정 (New York 스타일, Neutral base)
- ✅ ESLint, Prettier 설정
- ✅ 디렉토리 구조 설정

### 0-2. Supabase 기본 연동 ✅

- ✅ Supabase 프로젝트 생성 (Supabase Cloud)
- ✅ 환경 변수 설정 (.env.local)
- ✅ Supabase Client 설정 (SSR/CSR) - client/server/admin 3종
- ✅ 기본 스키마 설계 (15개 테이블 + 트리거)
- ✅ RLS(Row Level Security) 기본 정책 (멀티테넌시)

### 0-3. 기본 레이아웃 ✅

- ✅ 사이드바 네비게이션
- ✅ 헤더 (사용자 정보)
- ✅ 반응형 레이아웃 (모바일/태블릿/데스크톱)
- ✅ 기본 메뉴 구성 (역할 구분 없이)

### 0-4. 공통 UI 컴포넌트 ✅

- ✅ Form 컴포넌트 (React Hook Form + Zod 통합) - shadcn/ui form 설치
- ✅ DataTable 컴포넌트 (정렬, 필터, 페이지네이션) - TanStack Table + 서브 컴포넌트 4종
- ✅ Modal/Dialog 컴포넌트 - shadcn/ui dialog, alert-dialog 설치
- ✅ Toast 알림 시스템 - Sonner 전역 설정 + 헬퍼 함수
- ✅ Loading/Skeleton 컴포넌트 - CardSkeleton, TableSkeleton, FormSkeleton, Spinner

### 0-5. AI 추상화 레이어 ✅

- [x] 커스텀 에러 계층 (AIError, AIServiceError, AIValidationError, AIRateLimitError, AIConfigError)
- [x] 환경변수 검증 (Zod 스키마, 캐싱, AIConfigError 래핑)
- [x] AI Provider 인터페이스 + 타입 정의 (Factory + Strategy 패턴)
- [x] 재시도 유틸리티 (지수 백오프, 입력값 검증, AIRateLimitError 서버 명시 대기)
- [x] 응답 파싱/검증 (Zod 스키마 이중 활용 + 2단계 검증)
- [x] 프롬프트 템플릿 시스템 (프롬프트 빌더 + 배럴 파일)
- [x] Google Gemini 연동 (GeminiProvider 구현체, SDK 에러 변환, 재시도 통합)
- [x] Factory 함수 (createAIProvider, 환경변수/매개변수 기반 엔진 선택)
- [x] 공개 API (index.ts 배럴 파일, 내부 모듈 캡슐화)
- [x] 환경변수 템플릿 (.env.example 생성)

---

## 단계 1: 기출 기반 문제 생성 + 인증

> **통합 결과**: 로그인한 사용자가 기출문제를 업로드하고, AI로 유사 문제 생성 가능

### 1-1. 인증 시스템 [F010] ✅

- ✅ 회원가입 페이지 및 로직
- ✅ 로그인 페이지 및 로직
- ✅ 로그아웃 기능
- ✅ 비밀번호 재설정
- ✅ 세션 관리 미들웨어
- ✅ 인증 폼 UI 디자인
- ✅ 폼 유효성 검증
- ✅ 에러 메시지 처리

### 1-2. 기출문제 업로드 [F005] ✅

- ✅ 기출문제 업로드 (이미지/PDF)
- ✅ 기출문제 메타데이터 입력
- ✅ Storage 버킷 설정

### 1-3. 학교 관리 CRUD [F008] ✅

- ✅ 학교 목록 DataTable
- ✅ 학교 생성/수정/삭제
- ✅ 권한 체크 (admin/teacher)

### 1-4. 학원 관리 CRUD [F007] ✅

- ✅ 학원 정보 조회/수정
- ✅ 초대 코드 표시 (읽기 전용)

### 1-5. 사용자 관리 CRUD [F009] ✅

- ✅ 사용자 목록 DataTable
- ✅ 역할 변경 (admin 전용)
- ✅ 사용자 상세 조회

### 1-6. 기출문제 조회 [F006] 🚧 (2/5 Steps 완료)

- ✅ Zod 필터 스키마 (pastExamFilterSchema, 테스트 29개)
- ✅ Server Actions (getPastExamList, getPastExamDetail, 테스트 18개)
- [ ] DataTable UI (columns, toolbar, detail-sheet)
- [ ] 서버사이드 페이지네이션 UI
- [ ] 빌드 검증

### 1-7. 기출 기반 AI 문제 생성 [F011]

- [ ] 기출문제 분석 프롬프트
- [ ] 기출 기반 유사 문제 생성
- [ ] 기출 스타일 반영 옵션

### 1-8. 생성된 문제 저장 [F003]

- [ ] 문제 저장 및 관리
- [ ] 문제 목록/상세 조회

### 단계 1 통합 테스트

- [ ] 사용자 로그인 → 기출문제 업로드 → AI 문제 생성 플로우 E2E 테스트

---

## 단계 2: 성취기준 연동 + RBAC/대시보드

> **통합 결과**: 강사가 성취기준 선택 → 문제 생성 → 시험 생성 → PDF 출력 → 학생에게 배포

### 2-1. RBAC 시스템

- [ ] 역할 정의 (학원장, 강사, 학생, 학부모)
- [ ] 역할별 권한 매트릭스
- [ ] 보호된 라우트 미들웨어
- [ ] 역할 기반 UI 조건부 렌더링

### 2-2. 성취기준 DB 구축 [F002]

- [ ] 성취기준 데이터 스키마
- [ ] 성취기준 데이터 시딩 (교육과정 데이터)
- [ ] 성취기준 검색/필터 API
- [ ] 학년/학기/과목별 조회

### 2-3. 역할별 대시보드 [F018]

- [ ] 학원장 대시보드 (학원 현황, 통계)
- [ ] 강사 대시보드 (담당 학생, 시험 현황)
- [ ] 학생 대시보드 (내 시험, 성적 추이)
- [ ] 대시보드 위젯 시스템

### 2-4. 성취기준 기반 AI 문제 생성 [F001]

- [ ] 문제 생성 프롬프트 설계
- [ ] 성취기준 기반 문제 생성
- [ ] 다양한 문제 유형 지원 (객관식, 주관식, 서술형)
- [ ] 난이도별 문제 생성

### 2-5. 문제 검수 시스템 [F004]

- [ ] 검수 워크플로우 설계
- [ ] 문제 검수 UI (승인/수정/반려)
- [ ] 검수 이력 관리
- [ ] 문제 수정 에디터

### 2-6. 시험 생성 [F012]

- [ ] 시험 생성 위자드
- [ ] 문제 선택/배치 UI
- [ ] 배점 설정
- [ ] 시험 미리보기
- [ ] 시험 저장 및 상태 관리

### 2-7. 시험지 PDF 출력 [F013]

- [ ] PDF 템플릿 설계
- [ ] 문제 레이아웃 렌더링
- [ ] 답안지 생성
- [ ] PDF 다운로드/인쇄

### 2-8. 시험 목록/상세 UI

- [ ] 예정된 시험 목록
- [ ] 완료된 시험 목록
- [ ] 시험 상세 정보 조회

### 2-9. 시험 응시 진입점

- [ ] 시험 응시 시작 UI
- [ ] 시험 정보 확인 화면

### 단계 2 통합 테스트

- [ ] 강사: 성취기준 선택 → 문제 생성 → 검수 → 시험 생성 → PDF 출력 E2E 테스트

---

## 단계 3: AI 채점 + 채점/오답 UI

> **통합 결과**: 학생이 답안 제출 → AI 채점 → 강사 검수 → 학생 오답 확인

### 3-1. 답안 제출 UI [F014]

- [ ] 답안지 이미지 촬영/업로드
- [ ] 이미지 미리보기 및 재촬영
- [ ] 답안 제출 확인
- [ ] 제출 이력 조회

### 3-2. AI 채점 엔진 [F015]

- [ ] 채점 프롬프트 설계
- [ ] 객관식 자동 채점
- [ ] 주관식 AI 채점 (부분 점수)
- [ ] 서술형 AI 채점 (루브릭 기반)
- [ ] 채점 결과 저장

### 3-3. 채점 결과 UI

- [ ] 채점 결과 조회
- [ ] 문제별 정오 표시
- [ ] 점수 및 등급 표시
- [ ] 성취기준별 분석

### 3-4. 채점 검수 UI [F016]

- [ ] 채점 결과 검토 화면
- [ ] 점수 수정 기능
- [ ] 검수 승인/반려
- [ ] 일괄 검수 기능

### 3-5. 오답 노트 [F017]

- [ ] 틀린 문제 자동 수집
- [ ] 오답 노트 조회
- [ ] 오답 해설 표시
- [ ] 관련 유사 문제 추천

### 단계 3 통합 테스트

- [ ] 학생: 답안 제출 → AI 채점 → 강사 검수 → 오답 확인 E2E 테스트

---

## 단계 4: 개인화 + 학부모 리포트

> **통합 결과**: 개인화된 시험 추천, 학부모가 자녀 성적 및 취약점 확인

### 4-1. 학생 성취도 반영 문제 생성

- [ ] 학생별 취약점 분석 로직
- [ ] 성취도 기반 문제 난이도 조절
- [ ] 개인화 문제 추천 알고리즘

### 4-2. 학교/교사별 맞춤화

- [ ] 학교별 출제 패턴 분석
- [ ] 교사별 문제 스타일 반영
- [ ] 맞춤화 옵션 제공

### 4-3. 취약점 분석 UI

- [ ] 성취기준별 정답률 분석
- [ ] 취약 영역 시각화
- [ ] 학습 추천 제공

### 4-4. 학부모 리포트 [F019]

- [ ] 자녀 성적 조회
- [ ] 성적 추이 차트
- [ ] 취약점 요약

### 4-5. 리포트 PDF 출력

- [ ] 리포트 PDF 템플릿
- [ ] PDF 다운로드/인쇄

### 단계 4 통합 테스트

- [ ] 학부모: 자녀 성적 조회 → 취약점 확인 → 리포트 PDF 출력 E2E 테스트

---

## 알려진 설계 제약 및 개선 계획

### Phase 2+ 개선 예정 항목

| 항목 | 현재 상태 | 문제점 | 개선 계획 |
|------|----------|--------|----------|
| **grade 표기** | 1~12 (미국식 K-12) | 중3=9학년으로 표기되어 한국 현실과 안 맞음 | **Phase 2+**: UI 변환 함수로 우회 (MVP). 스키마 개선 또는 school_type별 grade 재설계 검토 |
| **학교 교사 관리** | 미지원 (teachers = 학원 교사만) | 학교별 출제 패턴 분석 시 학교 교사 정보 필요 | **Phase 2+**: school_teachers 테이블 추가 + 학교별 교사 출제 성향 분석 연동 (단계 4 또는 그 이전) |
| **학원 교사-과목-학년 정규화** | teachers.subjects/grades TEXT[]/INTEGER[] (배열) | 과목별로 담당 학년이 다를 경우 표현 불가 (예: 수학=중1~3, 영어=중1만) | **Phase 2+**: teacher_subjects(teacher_id, subject, grade) 중간 테이블로 정규화. 학교 교사 정규화와 함께 진행 |

### 학교 교사 관리 추가 계획 (Phase 2+)

**비즈니스 요구사항**:
- PRD F023: 교사 출제 성향 분석 — "특정 학교 교사의 출제 패턴 분석"
- 학교별 예상시험 생성 시 해당 학교 교사의 출제 스타일 반영 필요
- 학원 교사가 "강남중 수학 교사는 서술형을 많이 낸다" 같은 정보 입력 필요

**설계 방향**:
```sql
-- Phase 2+ 추가 예정
CREATE TABLE school_teachers (
  id UUID PRIMARY KEY,
  school_id UUID NOT NULL REFERENCES schools(id),
  name TEXT,  -- 실명 또는 익명 (A교사, B교사, NULL 가능)
  subject TEXT NOT NULL,
  hiring_year INTEGER,
  -- 출제 성향 분석 데이터
  question_style JSONB DEFAULT '{}',
  difficulty_preference JSONB DEFAULT '{}',
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now()
);

-- 학교 교사 - 과목 - 학년 다대다 (정규화)
CREATE TABLE school_teacher_subjects (
  school_teacher_id UUID REFERENCES school_teachers(id) ON DELETE CASCADE,
  subject TEXT NOT NULL,
  grade INTEGER NOT NULL CHECK (grade BETWEEN 1 AND 12),
  PRIMARY KEY (school_teacher_id, subject, grade)
);
```

**학원 교사 정규화** (함께 진행):
```sql
-- 기존 teachers.subjects, teachers.grades 배열 제거
-- 새 중간 테이블로 대체
CREATE TABLE teacher_subjects (
  teacher_id UUID REFERENCES teachers(id) ON DELETE CASCADE,
  subject TEXT NOT NULL,
  grade INTEGER NOT NULL CHECK (grade BETWEEN 1 AND 12),
  PRIMARY KEY (teacher_id, subject, grade)
);

-- 마이그레이션 스크립트 예시
-- INSERT INTO teacher_subjects (teacher_id, subject, grade)
-- SELECT t.id, unnest(t.subjects), unnest(t.grades)
-- FROM teachers t;
```

**데이터 소스**:
- **학교 교사 정보**: 학원 교사가 수동 입력 (학교 교사 정보는 공개되지 않으므로)
- **출제 성향 분석**: 기출문제(past_exam_questions)에서 AI로 패턴 자동 추출

**구현 우선순위**:
1. **단계 4 이전**: school_teachers 기본 CRUD (출제 성향 분석 준비)
2. **단계 4**: 출제 성향 분석 AI 연동 (question_style, difficulty_preference 자동 채움)
3. **단계 4 완료 후**: 학원 교사 정규화 마이그레이션 (선택적)

---

## 의존성 해결 전략

| 상황 | 해결 방법 |
|------|----------|
| 단계 3: 학생 성취도 데이터 없음 | Mock 데이터로 개발, 단계 4에서 실제 연동 |
| 스텝 간 데이터 의존 | 인터페이스(스키마, API 스펙) 우선 정의 |
| 통합 테스트 | 각 단계 완료 시 E2E 테스트 실시 |

---

## 마일스톤

| 마일스톤 | 단계 | 완료 조건 |
|---------|------|----------|
| **M0** | Phase 0 | 개발 기반 완성 |
| **M1** | 단계 1 | 기출 기반 문제 생성 + 인증 동작 |
| **M2** | 단계 2 | 강사의 시험 생성 → PDF 출력 플로우 완료 |
| **M3** | 단계 3 | 학생의 답안 제출 → 채점 → 오답 확인 플로우 완료 |
| **M4** | 단계 4 | 개인화 + 학부모 리포트 완료 |

---

## 기능 ID 매핑

| 기능 ID | 기능명 | 개발 단계 |
|---------|--------|----------|
| F001 | 성취기준 기반 AI 문제 생성 | 단계 2 |
| F002 | 성취기준 관리 | 단계 2 |
| F003 | 문제 저장 및 관리 | 단계 1 |
| F004 | 문제 검수 시스템 | 단계 2 |
| F005 | 기출문제 업로드 | 단계 1 |
| F006 | 기출문제 조회 | 단계 1 |
| F007 | 학원 관리 | 단계 1 |
| F008 | 학교 관리 | 단계 1 |
| F009 | 사용자 관리 | 단계 1 |
| F010 | 회원가입/로그인 | 단계 1 |
| F011 | 기출 참고 AI 출제 | 단계 1 |
| F012 | 시험 생성 | 단계 2 |
| F013 | 시험지 PDF 출력 | 단계 2 |
| F014 | 답안 제출 | 단계 3 |
| F015 | AI 채점 | 단계 3 |
| F016 | 채점 검수 | 단계 3 |
| F017 | 오답 노트 | 단계 3 |
| F018 | 역할별 대시보드 | 단계 2 |
| F019 | 학부모 리포트 | 단계 4 |

---

## 진행 상황 요약

| Phase/단계 | 진행률 | 상태 |
|-----------|--------|------|
| Phase 0 (최소 공통 기능) | 100% (5/5 완료) | ✅ 완료 |
| 단계 1 (기출 기반 문제 생성 + 인증) | 63% (1-1~1-5 완료, 1-6 진행 중 2/5) | 🚧 진행 중 |
| 단계 2 (성취기준 연동 + RBAC/대시보드) | 0% | ⏸️ 대기 |
| 단계 3 (AI 채점 + 채점/오답 UI) | 0% | ⏸️ 대기 |
| 단계 4 (개인화 + 학부모 리포트) | 0% | ⏸️ 대기 |

### Phase 0 상세 진행 상황
- ✅ 0-1. 프로젝트 초기화 (완료)
- ✅ 0-2. Supabase 기본 연동 (완료)
- ✅ 0-3. 기본 레이아웃 (완료)
- ✅ 0-4. 공통 UI 컴포넌트 (완료)
- ✅ 0-5. AI 추상화 레이어 (완료 - 12/12 Steps)
